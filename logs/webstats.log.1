2025-11-03 21:12:48,842 INFO: Webstats startup [in D:\PycharmProjects\MagicWebStats\app\__init__.py:71]
2025-11-03 21:14:26,819 ERROR: Exception on /LoadAllDecks [GET] [in D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\flask\app.py:875]
Traceback (most recent call last):
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\flask\app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\flask\app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\flask\app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\flask\app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "D:\PycharmProjects\MagicWebStats\app\auth\__init__.py", line 16, in decorated_view
    return func(*args, **kwargs)
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\flask_login\utils.py", line 290, in decorated_view
    return current_app.ensure_sync(func)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "D:\PycharmProjects\MagicWebStats\app\third_party_data\deckbuilder.py", line 80, in load_all_decks
    if not deck.decklist == None and deck.decksite == None:
           ^^^^^^^^^^^^^
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1126, in _fire_loader_callables
    return state._load_expired(state, passive)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 1674, in load_scalar_attributes
    result = load_on_ident(
        session,
    ...<4 lines>...
        no_autoflush=no_autoflush,
    )
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 510, in load_on_ident
    return load_on_pk_identity(
        session,
    ...<11 lines>...
        is_user_refresh=is_user_refresh,
    )
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 695, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 101, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\PycharmProjects\MagicWebStats\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
    ...<6 lines>...
    )
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (psycopg2.errors.ForeignKeyViolation) insert or update on table "deck_component" violates foreign key constraint "fk_deck_component_card"
DETAIL:  Key (card_id)=(66b0c460-9c8b-4e1a-8b61-a1fa8f1a896e) is not present in table "card_data".

[SQL: INSERT INTO data_owner.deck_component (deck_id, card_id, count, name) SELECT p0::INTEGER, p1::VARCHAR, p2::INTEGER, p3::VARCHAR FROM (VALUES (%(deck_id__0)s, %(card_id__0)s, %(count__0)s, %(name__0)s, 0), (%(deck_id__1)s, %(card_id__1)s, %(count__1)s ... 6089 characters truncated ... ) ORDER BY sen_counter RETURNING data_owner.deck_component.id, data_owner.deck_component.id AS id__1]
[parameters: {'card_id__0': '1e4e9e35-6cbc-4997-beff-d1a22d87545e', 'name__0': 'Find // Finality', 'deck_id__0': 137, 'count__0': 1, 'card_id__1': 'c79dedcf-ecba-49a1-81dc-7e3bdb7abefd', 'name__1': 'Artisan of Kozilek', 'deck_id__1': 137, 'count__1': 1, 'card_id__2': '618d21fe-8e3d-4887-b2e4-b92194ba1902', 'name__2': 'Moldervine Reclamation', 'deck_id__2': 137, 'count__2': 1, 'card_id__3': '851f8d1f-163c-4c4f-beee-431b64ec8a99', 'name__3': 'Greed', 'deck_id__3': 137, 'count__3': 1, 'card_id__4': '28f6e33d-9258-4bad-8f39-31afff272415', 'name__4': 'Falkenrath Noble', 'deck_id__4': 137, 'count__4': 1, 'card_id__5': 'd4558304-7c17-4aa0-bd50-cdd95547f1a7', 'name__5': 'Forest', 'deck_id__5': 137, 'count__5': 6, 'card_id__6': 'b87891cd-b457-4dff-8d18-a7eaf6748fc6', 'name__6': "Witch's Cottage", 'deck_id__6': 137, 'count__6': 1, 'card_id__7': '4e5d9776-b6ce-4ad6-8acc-69115ba5de76', 'name__7': 'Winding Way', 'deck_id__7': 137, 'count__7': 1, 'card_id__8': 'ccc1c460-64c5-47be-a633-439863baa6a1', 'name__8': 'Ghost Quarter', 'deck_id__8': 137, 'count__8': 1, 'card_id__9': '30b3d647-3546-4ade-b395-f2370750a7a6', 'name__9': 'Swamp', 'deck_id__9': 137, 'count__9': 2, 'card_id__10': '3e02dd03-cced-43b7-ba8f-cdcf9083252a', 'name__10': 'Harvester of Souls', 'deck_id__10': 137, 'count__10': 1, 'card_id__11': '05b2af75-2e29-446b-b3d0-00b5e5d50b3c', 'name__11': 'Woe Strider', 'deck_id__11': 137, 'count__11': 1, 'card_id__12': 'f6cea55e-f85a-4f0f-b845-386d5c3fd9db', 'name__12': 'Wood Elves' ... 260 parameters truncated ... 'deck_id__77': 137, 'count__77': 1, 'card_id__78': 'cde12c36-f49b-4065-987f-981ca32d536d', 'name__78': 'Casualties of War', 'deck_id__78': 137, 'count__78': 1, 'card_id__79': 'afcc9c88-836b-48b6-9d81-5a6844a6b70f', 'name__79': 'Warping Wail', 'deck_id__79': 137, 'count__79': 1, 'card_id__80': 'a402cff8-be7f-4473-b880-a6a2eedfda86', 'name__80': 'Ophiomancer', 'deck_id__80': 137, 'count__80': 1, 'card_id__81': '932d48fb-42b5-4aaa-a91c-d35cdb5e41a3', 'name__81': 'Acidic Slime', 'deck_id__81': 137, 'count__81': 1, 'card_id__82': 'a485c97f-2d15-4012-a64c-4199ac2c8d01', 'name__82': 'Deathsprout', 'deck_id__82': 137, 'count__82': 1, 'card_id__83': 'a6abde7a-da2a-4631-9db6-9d0ffe1e1105', 'name__83': 'Hydra Omnivore', 'deck_id__83': 137, 'count__83': 1, 'card_id__84': 'c9b1d4d8-7df9-41e0-b2d9-dbca9c9f6994', 'name__84': 'Pathrazer of Ulamog', 'deck_id__84': 137, 'count__84': 1, 'card_id__85': '699c0f6f-b26b-4741-8140-8a6030cad127', 'name__85': "Ulamog's Crusher", 'deck_id__85': 137, 'count__85': 1, 'card_id__86': '3fc7210c-da23-4cec-9195-4de75587f40f', 'name__86': 'Back for More', 'deck_id__86': 137, 'count__86': 1, 'card_id__87': '30b3d647-3546-4ade-b395-f2370750a7a6', 'name__87': 'Swamp', 'deck_id__87': 137, 'count__87': 6, 'card_id__88': 'e488ed05-d63a-4852-b5e9-d7357c60c3e6', 'name__88': 'Viridian Emissary', 'deck_id__88': 137, 'count__88': 1, 'card_id__89': '66b0c460-9c8b-4e1a-8b61-a1fa8f1a896e', 'name__89': 'Meren of Clan Nel Toth', 'deck_id__89': 137, 'count__89': 1}]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-11-03 21:14:55,371 INFO: Webstats startup [in D:\PycharmProjects\MagicWebStats\app\__init__.py:71]
