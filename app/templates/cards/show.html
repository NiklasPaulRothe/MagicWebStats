{% extends "base.html" %}

{% block head %}
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/deckpage.css') }}">
</head>
{% endblock %}

{% block content %}
    <h2>Kartenmeta</h2>
    <deckpage>
        <div id="right"><table id="user-deck-stats-table">
                <thead>
                    <tr>
                        <th data-type="number">Name</th>
                        <th data-type="string">Anzahl</th>
                    </tr>
                </thead>
                <tbody>
                {% for card in cards %}
                <tr>
                    <td>{{ card.Name }}</td>
                    <td>{{ card.Count }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table></div>
    </deckpage>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sort table functionality
            const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;

            const comparer = (idx, asc, type) => (a, b) => ((v1, v2) =>
                    v1 !== '' && v2 !== '' && (type === 'number' ? (parseFloat(v1) - parseFloat(v2)) : v1.toString().localeCompare(v2))
            )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));

            document.querySelectorAll('th').forEach(th => th.addEventListener('click', function () {
                const table = th.closest('table');
                const tbody = table.querySelector('tbody');
                Array.from(tbody.querySelectorAll('tr'))
                    .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc, th.getAttribute('data-type')))
                    .forEach(tr => tbody.appendChild(tr));
            }));
        });
    </script>
{%  endblock %}